//Homepage
$(function(){try{WindowMax(),GetLoginInfo(),$("#LogionLogs").html(""),$.ajax({type:"POST",url:"/Main/SearchList/?SearchId\x3d SysSearch00000013\x26TableName\x3dSysLogs\x26rod\x3d"+Math.floor(1E3*Math.random()),success:function(b){b=$.string.toObject(b);0<b.total&&$.each(b.rows,function(a,c){if(20>a){var b=$("#LogionLogs").html();$("#LogionLogs").html(b+'\x3cul class\x3d"portlet-list"\x3e'+c.SysLOGS_Contents+"\u65f6\u95f4\uff1a["+c.SysLOGS_CreateDate+"]\x3c/ul\x3e")}})}}),opsTab={title:"\u7cfb\u7edf\u4e3b\u9875",href:"/main/HomePage/?ScreenHeight\x3d"+screen.height,iniframe:!0,closable:!1,refreshable:!0,iconCls:"icon-standard-house",repeatable:!0,selected:!0},window.mainpage.mainTabs.addModule(opsTab),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}catch(b){}});(function(b){b.util.namespace("mainpage.nav");b.util.namespace("mainpage.mainTabs");window.mainpage.loadMenu=function(a){b("#navMenu_list").find("a").attr("disabled",!0);b.easyui.loading({locale:"#westCenterLayout"});var c=b("#navMenu_Tree"),d=b.extend({},b.array.first(window.mainpage.navMenusData,function(b){return b.id==a}));b.get("/Main/GetChildrenMenusAuthorization/?parentId\x3d"+a+"\x26id\x3drood\x3d"+Math.floor(1E3*Math.random()),function(a){d.children=a;debugger;c.tree("loadData",[d])},"json")};window.mainpage.loadNavMenus=function(a){var c=b("#navMenu_list").empty();b.get("/Main/GetTopMenuAuthorization/?id\x3drod\x3d"+Math.floor(1E3*Math.random()),function(d){b.each(window.mainpage.navMenusData=d=b.array.filter(d,function(a){return a.disabled?!1:!0}),function(a,d){var e=b("\x3cli\x3e\x3c/li\x3e").appendTo(c),e=b("\x3cdiv\x3e\x3c/div\x3e").addClass("panel-header panel-header-noborder").appendTo(e),f=b("\x3ca style\x3d'font-size:15px'\x3e\x3c/a\x3e").attr({href:"javascript:void(0);",target:"_self",style:"font-size:15px"}).hover(function(){f.addClass("tree-node-selected")},function(){f.hasClass("selected")||b(this).removeClass("tree-node-selected")}).click(function(){f.is(".tree-node-selected.selected")||f.attr("disabled")||(c.find("a").removeClass("tree-node-selected selected"),f.addClass("tree-node-selected selected"),window.mainpage.loadMenu(d.id))}).appendTo(e);b.data(f[0],"menu-item",d);b('\x3cspan class\x3d"l-btn-left l-btn-icon-left nav-menu"\x3e\x3cspan class\x3d"l-btn-text"\x3e'+(d.text?d.text:"\u65e0\u540d\u79f0\u533a\u57df")+'\x3c/span\x3e\x3cspan class\x3d"l-btn-icon'+(d.iconCls?" "+d.iconCls:"")+'"\x3e\x3c/span\x3e\x3c/span\x3e').appendTo(f)});var e=b("#westLayout"),f=e.layout("panel","south").panel("options");f.minHeight=5+31*Math.min(d.length,3);f.maxHeight=5+31*d.length;e.layout("resize");b.isFunction(a)&&a.call(c,d)},"json")};window.mainpage.instTreeStatus=function(a){b(a).tree("getRoots")};window.mainpage.instNavTree=function(){var a=b("#navMenu_Tree");a.isEasyUI("tree")||a.tree({lines:!0,toggleMenu:!1,contextMenu:!1,autoBindDblClick:!0,enableContextMenu:!0,selectOnContextMenu:!0,toggleOnClick:!0,dnd:!0,onDragEnter:function(a,b){return!1},onDragEnter:function(a,b){return!1},onClick:function(a){window.mainpage.OpenTypeForTree(a)},onLoadSuccess:function(c,d){b("#navMenu_list").find("a").removeAttr("disabled");window.mainpage.instTreeStatus(a);b.easyui.loaded("#westCenterLayout")},onAfterEdit:function(a){window.mainpage.nav.rename(a.id,a.text)}})};window.mainpage.OpenType=function(a){var c,d=a||{},e=a.attributes||{};b.extend({},d,{title:d.text},e);if(e.href)-1<e.href.indexOf("{")?(c=b.string.toObject(a.attributes.href),c=c.type?c.type:"search"):c="search";else if(!a.children){b.easyui.messager.alert("\u64cd\u4f5c\u63d0\u9192","\u83dc\u5355\u5730\u5740\u5b9a\u4e49\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5\uff01");return}"search"==c?window.mainpage.addModuleTab(a):"form"==c?window.mainpage.ShowDg(a):"FormEdit"==c?window.mainpage.ShowDg(a):window.mainpage.addModuleTab(a)};window.mainpage.OpenTypeForTree=function(a){var c,d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e);if(e.href)-1<e.href.indexOf("{")?(c=b.string.toObject(a.attributes.href),c=c.type?c.type:"search"):c="search";else if(!a.children){b.easyui.messager.alert("\u64cd\u4f5c\u63d0\u9192","\u83dc\u5355\u5730\u5740\u5b9a\u4e49\u51fa\u9519\uff0c\u8bf7\u68c0\u67e5\uff01");return}debugger;c=c.toLowerCase();if("search"==c)window.mainpage.addModuleTab(a);else if("form"==c)window.mainpage.ShowDg(a);else if("formedit"==c){if(d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e),d.href){c=eval("("+e.href+")");e=a.text;a=a.iconCls;var d=c.FormId,f=c.Parses,k=c.width,l=c.height;ShowFormEdit(e,a,c.TableName,d,c.Id,k,l,f)}}else if("formadd"==c)d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e),d.href&&(c=eval("("+e.href+")"),e=a.text,a=a.iconCls,d=c.FormId,f=c.Parses,k=c.width,l=c.height,ShowFormAdd(e,a,d,k,l,f));else if("formtotab"==c)d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e),d.href&&(c=eval("("+e.href+")"),e=a.text,a=a.iconCls,d=c.FormId,window.mainpage.mainTabs.addModule(e,"/Main/AddFormTest/?FormId\x3d"+d,a,!1));else if("gridtreetotab"==c)d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e),d.href&&(c=eval("("+e.href+")"),e=a.text,a=a.iconCls,d=c.FormId,window.mainpage.mainTabs.addModule(e,"/Main/AddGridTree/?FormId\x3d"+d,a,!1));else if("js"==c){if(d=a||{},e=a.attributes||{},d=b.extend({},d,{title:d.text},e),d.href){debugger;c=eval("("+e.href+")");eval(c.script)}}else window.mainpage.addModuleTab(a)};window.mainpage.instMainMenus=function(){window.mainpage.loadNavMenus(function(){window.mainpage.instNavTree();if(window.mainpage.navMenusData.length){var a=b("#navMenu_list").find("a");if(a.length){var c=a.filter(function(){var a=b.data(this,"menu-item");return a&&11==a.id});(c.length?c:a.eq(0)).click()}}})};window.mainpage.bindToolbarButtonEvent=function(){b("#btnHideNorth").click(function(){window.mainpage.hideNorth()});var a=b("#btnShowNorth").click(function(){window.mainpage.showNorth()}),c=b("#mainLayout").layout("panel","north"),d=c.panel("panel"),e=b("#toolbar"),f=b("#topbar");opts=c.panel("options");onCollapse=opts.onCollapse;onExpand=opts.onExpand;opts.onCollapse=function(){b.isFunction(onCollapse)&&onCollapse.apply(this,arguments);a.show();e.insertBefore(d).addClass("top-toolbar-topmost")};opts.onExpand=function(){b.isFunction(onExpand)&&onExpand.apply(this,arguments);a.hide();e.insertAfter(f).removeClass("top-toolbar-topmost")};b("#btnFullScreen").click(function(){b.util.supportsFullScreen?b.util.isFullScreen()?b.util.cancelFullScreen():b.util.requestFullScreen():b.easyui.messager.show("\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5168\u5c4f API\uff0c\u8bf7\u66f4\u6362\u81f3\u6700\u65b0\u7684 Chrome/Firefox/Safari \u6d4f\u89c8\u5668\u6216\u901a\u8fc7 F11 \u5feb\u6377\u952e\u8fdb\u884c\u64cd\u4f5c\u3002")});b("#btnExit").click(function(){UserExit()})};window.mainpage.search=function(a,c){b.easyui.messager.show(b.string.format("\u60a8\u8bbe\u7f6e\u7684\u4e3b\u9898\u4e3a\uff1avalue: {0}, name: {1}",a,c))};window.mainpage.bindMainTabsButtonEvent=function(){b("#mainTabs_jumpHome").click(function(){window.mainpage.mainTabs.jumpHome()});b("#mainTabs_toggleAll").click(function(){window.mainpage.togglePanels()});b("#mainTabs_jumpTab").click(function(){window.mainpage.mainTabs.jumpTab()});b("#mainTabs_closeTab").click(function(){window.mainpage.mainTabs.closeCurrentTab()});b("#mainTabs_closeOther").click(function(){window.mainpage.mainTabs.closeOtherTabs()});b("#mainTabs_closeLeft").click(function(){window.mainpage.mainTabs.closeLeftTabs()});b("#mainTabs_closeRight").click(function(){window.mainpage.mainTabs.closeRightTabs()});b("#mainTabs_closeAll").click(function(){window.mainpage.mainTabs.closeAllTabs()})};window.mainpage.bindNavTabsButtonEvent=function(){b("#navMenu_refresh").click(function(){window.mainpage.refreshNavTab()});b("#navMenu_Favo").click(function(){window.mainpage.nav.addFavo()});b("#navMenu_Rename").click(function(){window.mainpage.nav.rename()});b("#navMenu_expand").click(function(){window.mainpage.nav.expand()});b("#navMenu_collapse").click(function(){window.mainpage.nav.collapse()});b("#navMenu_collapseCurrentAll").click(function(){window.mainpage.nav.expandCurrentAll()});b("#navMenu_expandCurrentAll").click(function(){window.mainpage.nav.collapseCurrentAll()});b("#navMenu_collapseAll").click(function(){window.mainpage.nav.expandAll()});b("#navMenu_expandAll").click(function(){window.mainpage.nav.collapseAll()})};window.mainpage.hideNorth=function(){b("#mainLayout").layout("collapse","north")};window.mainpage.showNorth=function(){b("#mainLayout").layout("expand","north")};window.mainpage.togglePanels=function(){b("#mainLayout").layout("toggleAll","collapse")};window.mainpage.ShowDg=function(a){var c=a||{};a=a.attributes||{};c=b.extend({},c,{title:c.text},a);c.href&&(a=eval("("+a.href+")"),b.easyui.showDialog({title:c.text,iconCls:c.iconCls,width:a.width,height:a.height,topMost:!1,minWidth:400,minHeight:300,href:a.href+"\x26rod\x3d"+Math.floor(1E3*Math.random()),closeButtonText:"\u53d6\u6d88",enableSaveButton:!1,saveButtonText:"\u4fdd\u5b58",enableApplyButton:!1,autoCloseOnEsc:!0,buttons:[{text:"\u4fdd\u5b58\u8868\u5355",iconCls:"icon-save",handler:function(a){}}]}))};window.mainpage.ShowDgForStr=function(a,c,d,e,f){a=""!=a?a:"";c=""!=c?c:"";d=""!=d?d:"";e=""!=e?parseInt(e):600;f=""!=f?parseInt(f):400;b.easyui.showDialog({title:a,iconCls:c,width:e,height:f,topMost:!1,minWidth:400,minHeight:300,href:d+"\x26rod\x3d"+Math.floor(1E3*Math.random()),closeButtonText:"\u53d6\u6d88",enableSaveButton:!1,saveButtonText:"\u4fdd\u5b58",enableApplyButton:!1,autoCloseOnEsc:!0,buttons:[{text:"\u4fdd\u5b58\u8868\u5355",iconCls:"icon-save",handler:function(a){}}]})};window.mainpage.addModuleTab=function(a){var c=a||{};a=b.extend({},c,{title:c.text},a.attributes||{});a.href&&window.mainpage.mainTabs.addModule(a)};window.mainpage.mainTabs.isExists=function(a,c){var d=b("#mainTabs").tabs("tabs"),d=b.array.map(d,function(a){return a.panel("options")}),d=b.array.filter(d,function(b){return b.title==a}),e=d.length?1:0;e&&b.array.some(d,function(a){return a.href==c})&&(e=2);return e};window.mainpage.mainTabs.tabDefaultOption={title:"\u65b0\u5efa\u9009\u9879\u5361",href:"",iniframe:!0,closable:!0,refreshable:!0,iconCls:"icon-standard-application-form",repeatable:!0,selected:!0};window.mainpage.mainTabs.parseCreateTabArgs=function(a){var c={};a&&a.length?1==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,"object"==typeof a[0]?a[0]:{href:a[0]}):2==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1]}):3==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1],iconCls:a[2]}):4==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1],iconCls:a[2],iniframe:a[3]}):5==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1],iconCls:a[2],iniframe:a[3],closable:a[4]}):6==a.length?b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1],iconCls:a[2],iniframe:a[3],closable:a[4],refreshable:a[5]}):7<=a.length&&b.extend(c,window.mainpage.mainTabs.tabDefaultOption,{title:a[0],href:a[1],iconCls:a[2],iniframe:a[3],closable:a[4],refreshable:a[5],selected:a[6]}):b.extend(c,window.mainpage.mainTabs.tabDefaultOption);return c};window.mainpage.mainTabs.createTab=function(a,c,d,e,f,k,l){for(var g=b("#mainTabs"),h=0,m=window.mainpage.mainTabs.parseCreateTabArgs(arguments);g.tabs("getTab",m.title+(h?String(h):""));)h++;g.tabs("add",m)};window.mainpage.mainTabs.addModule=function(a,b,d,e,f,k,l){var g=window.mainpage.mainTabs.parseCreateTabArgs(arguments);switch(window.mainpage.mainTabs.isExists(g.title,g.href)){case 0:window.mainpage.mainTabs.createTab(g);break;case 1:window.mainpage.mainTabs.closeTab(g.title);window.mainpage.mainTabs.createTab(g);break;case 2:window.mainpage.mainTabs.closeTab(g.title),window.mainpage.mainTabs.createTab(g)}};window.mainpage.mainTabs.jumeTab=function(a){b("#mainTabs").tabs("select",a)};window.mainpage.mainTabs.jumpHome=function(){var a=b("#mainTabs"),c=a.tabs("tabs");(c=b.array.first(c,function(a){a=a.panel("options");return"\u4e3b\u9875"==a.title&&null==a.href}))&&c.length&&(c=a.tabs("getTabIndex",c),a.tabs("select",c))};window.mainpage.mainTabs.jumpTab=function(a){b("#mainTabs").tabs("jumpTab",a)};window.mainpage.mainTabs.closeTab=function(a){b("#mainTabs").tabs("close",a)};window.mainpage.mainTabs.closeCurrentTab=function(){var a=b("#mainTabs"),c=a.tabs("getSelectedIndex");return a.tabs("closeClosable",c)};window.mainpage.mainTabs.closeOtherTabs=function(a){var c=b("#mainTabs");if(null==a||void 0==a)a=c.tabs("getSelectedIndex");return c.tabs("closeOtherClosable",a)};window.mainpage.mainTabs.closeLeftTabs=function(a){var c=b("#mainTabs");if(null==a||void 0==a)a=c.tabs("getSelectedIndex");return c.tabs("closeLeftClosable",a)};window.mainpage.mainTabs.closeRightTabs=function(a){var c=b("#mainTabs");if(null==a||void 0==a)a=c.tabs("getSelectedIndex");return c.tabs("closeRightClosable",a)};window.mainpage.mainTabs.closeAllTabs=function(){return b("#mainTabs").tabs("closeAllClosable")};window.mainpage.refreshNavTab=function(a){window.mainpage.nav.refreshTree()};window.mainpage.nav.refreshNav=function(){window.mainpage.instMainMenus()};window.mainpage.nav.refreshTree=function(){var a=b("#navMenu_list").find("a.tree-node-selected.selected");(a=b.data(a[0],"menu-item"))&&a.id&&window.mainpage.loadMenu(a.id)};window.mainpage.nav.addFavo=function(a){var c=b("#navMenu_Tree");if(arguments.length?!c.tree("find",a):!c.tree("getSelected"))return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e")};window.mainpage.nav.rename=function(a,c){var d=b("#navMenu_Tree"),e;if(!arguments.length){e=d.tree("getSelected");if(!e)return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e");d.tree("beginEdit",e.target)}};window.mainpage.nav.expand=function(a){var c=b("#navMenu_Tree");if(null==a||void 0==a){if(a=c.tree("getSelected"),!a)return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e")}else if(a=c.tree("find",a),!a)return b.easyui.messager.show("\u8bf7\u4f20\u5165\u6709\u6548\u7684\u53c2\u6570 id(\u83dc\u5355\u6807\u8bc6\u53f7)");c.tree("expand",a.target)};window.mainpage.nav.collapse=function(a){var c=b("#navMenu_Tree");if(null==a||void 0==a){if(a=c.tree("getSelected"),!a)return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e")}else if(a=c.tree("find",a),!a)return b.easyui.messager.show("\u8bf7\u4f20\u5165\u6709\u6548\u7684\u53c2\u6570 id(\u83dc\u5355\u6807\u8bc6\u53f7)");c.tree("collapse",a.target)};window.mainpage.nav.expandCurrentAll=function(a){var c=b("#navMenu_Tree");if(null==a||void 0==a){if(a=c.tree("getSelected"),!a)return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e")}else if(a=c.tree("find",a),!a)return b.easyui.messager.show("\u8bf7\u4f20\u5165\u6709\u6548\u7684\u53c2\u6570 id(\u83dc\u5355\u6807\u8bc6\u53f7)");c.tree("expandAll",a.target)};window.mainpage.nav.collapseCurrentAll=function(a){var c=b("#navMenu_Tree");if(null==a||void 0==a){if(a=c.tree("getSelected"),!a)return b.easyui.messager.show("\u8bf7\u5148\u9009\u62e9\u4e00\u884c\u6570\u636e")}else if(a=c.tree("find",a),!a)return b.easyui.messager.show("\u8bf7\u4f20\u5165\u6709\u6548\u7684\u53c2\u6570 id(\u83dc\u5355\u6807\u8bc6\u53f7)");c.tree("collapseAll",a.target)};window.mainpage.nav.expandAll=function(){b("#navMenu_Tree").tree("expandAll")};window.mainpage.nav.collapseAll=function(){b("#navMenu_Tree").tree("collapseAll")}})(jQuery);function GetLoginInfo(){$.ajax({type:"POST",url:"/Users/GetUserLogin",success:function(b){$("#userinfo").html(b)}})}function LeftMenuShow(){""==$("#UserName").val()||""==$("#PassWord").val()||""==$("#UserType").val()?$.messager.alert("\u63d0\u793a","\u7528\u6237\u7c7b\u578b\u3001\u7528\u6237\u540d\u3001\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"):$.ajax({type:"POST",url:"/Users/UserLogin",data:"username\x3d"+$("#UserName").val()+"\x26PassWord\x3d"+$("#PassWord").val()+"\x26UserType\x3d"+$("#UserType").val()+"\x26anticache\x3d"+Math.floor(1E3*Math.random()),beforeSend:function(b){$.messager.progress()},success:function(b){0<eval("("+b+")").totalProperty?(closeWindow(),OpenwinFull("/main/home")):($.messager.progress("close"),$.messager.alert("\u767b\u5f55\u5931\u8d25","\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff01"))},complete:function(b,a){$.messager.progress("close")},error:function(b){str="\u53d1\u751f\u5f02\u5e38\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01";$.messager.alert("\u63d0\u793a",str)}})}function SignalRJs(b){var a=$.connection.chatHuba,c="";try{a.client.showMessage=function(d,e,f,k,l,g,h,m){"*"==g?(c!=h&&(a.server.updateMessageState(m),void 0==$("#ContenMsg")[0]?ShowFormAdd("\u5373\u65f6\u901a\u4fe1","icon-hamburg-contact","SysForm00000085",770,479,"{info:'"+h+"'}"):(d=$("#ContenMsg").panel("options").content,$("#ContenMsg").panel({content:d+"\uff1a\x3cbr\x3e\x3cspan style\x3d'color:#CC0000'\x3e"+h+"\x3c/span\x3e"}))),c=h):g==b&&(c!=h&&(a.server.updateMessageState(m),void 0==$("#ContenMsg")[0]?ShowFormAdd("\u5373\u65f6\u901a\u4fe1","icon-hamburg-contact","SysForm00000085",770,479,"{info:'"+h+"'}"):(d=$("#ContenMsg").panel("options").content,$("#ContenMsg").panel({content:d+"\uff1a\x3cbr\x3e\x3cspan style\x3d'color:#CC0000'\x3e"+h+"\x3c/span\x3e"}))),c=h)},a.client.MessageToServer=function(){a.server.sendUser()},$.connection.hub.start().done(function(){a.server.getUser(b)}),$.connection.hub.start()}catch(d){}};